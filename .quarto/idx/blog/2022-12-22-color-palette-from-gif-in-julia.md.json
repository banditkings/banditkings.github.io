{"title":"Creating Color Palettes from Animated GIFs with Julia","markdown":{"yaml":{"title":"Creating Color Palettes from Animated GIFs with Julia","date":"2022-12-22","categories":["julia","data visualization"],"summary":"How to automatically generate custom color palettes for data visualization from animated GIFs with Julia","images":["/static/images/palettes/existing_solutions.png","/static/images/palettes/edgerunners mv.gif","/static/images/palettes/edgerunners mv.png","/static/images/palettes/overwatch2 genji.gif","/static/images/palettes/genji.png","/static/images/palettes/zuko-azula.gif","/static/images/palettes/zuko-azula.png"]},"headingText":"Solution: Combine clustering with a few extra steps","containsRefs":false,"markdown":"\n\nHave you ever watched a movie and thought to yourself: \"I bet that scene would make for a great plotting theme.\" Yeah, me too!\n\nRecently I've been drawing inspiration from scenes from anime such as _Cyberpunk: Edgerunners_ ([on Netflix](https://www.netflix.com/title/81054853)), where rich greens, bright pinks, and yellows form a coherent color signature. Color palettes can invoke memories of characters or key moments, and I've found that incorporating even a few of those colors in my data visualizations has rekindled the joy of opening up my IDE and doing some EDA.\n\nUnfortunately, creating custom palettes is time intensive and I have more inspiration than I have free time (especially with two young kids!). Existing free online color palette generators such as [Coolors](https://coolors.co/image-picker), [Adobe Color](https://color.adobe.com/create/image), and [Canva](https://www.canva.com/colors/color-palette-generator/) reveal some limitations:\n\n- Many solutions are _manual_ - users need to manually select colors from an image, which relies on the users' design sense to pick meaningful color combinations\n- Many Automated solutions are _incoherent_ for data visualization - they might select colors that are so similar that they're indistinguishable from each other\n- Existing solutions only take a static image that may fail to capture key colors from the entire scene\n\nHere's an example of what I mean:\n\nI have a GIF captured from a [Cyberpunk: Edgerunners music video](https://youtu.be/h4VJGNNSQnw?t=223) that I want to use to make a color palette for data viz. There's two characters in the scene, Lucy and David:\n\n![img](/static/images/palettes/edgerunners_mv.gif)\n\nBecause existing solutions only let you take a static image, we're forced with taking a single frame from the animation and plug it into a few of them:\n\n![img](/static/images/palettes/existing_solutions.png)\n\n- Canva provides the best palette but only allowed for 4 colors, and notice that purple color doesn't appear in the original image\n- Adobe Color completely missed the pink color and went right to blues and greens\n- Coolors picked a bunch of blue colors, and the last three colors are really hard to tell which is which!\n\n\nGiven these gripes with existing palette generators, I decided to make a little function in Julia to extract coherent color palettes from animated GIFs. Clustering (K-means) can summarize the key colors in the GIF and we can use a few simple rules to make a data viz color palette from those key colors.\n\n[Julia's `Images.jl` library](https://juliaimages.org/stable/) is great for working with images (to include animated GIFs), and Julia's type system and native arrays make it trivial to do math on both static and animated images.\n\n## Methods\n\nK-means clustering is a tried and true method for extracting color palettes from images. The basic idea with K-means is that it will iteratively find $K$ cluster centers from the image, where each cluster center is a color that's _close_ to a bunch of colors in the image.\n\n### Rule 1: Ensuring that we use an actual color from the image\n\nThe downside of K-means is that **there's no guarantee that this color actually appears in the original image**!\n\nWe can overcome this with a simple decision rule that substitutes each cluster center with the _nearest_ closest color that exists in the original image. Since each pixel is just an array of numbers, we can calculate _closeness_ using a simple measure like Euclidean distance.\n\n### Rule 2: Use colors that are different from each other\n\nI also want to ensure there's a _minimum distance_ or threshold value between every color in our color palette so that viewers can tell them apart.\n\nTo make this happen we can use a greedy algorithm, something like the below:\n\n- Given an initial list of $K$ colors from the K-means cluster centers:\n  1. Initialize our selected palette with two colors:\n     1. Start with the most common color in the image - this'll be the background color in our data viz\n     2. Find the color with the highest distance from the most common color - this'll be the text/axis/gridline color since it pops out the most from the background\n  2. Rule out any colors from the list of remaining cluster centers that don't meet the minimum distance threshold to any of the selected colors\n  3. From the remaining cluster centers, add the color that has the highest _mean_ distance to the colors in the selected palette\n  4. Repeat steps 2 and 3 until there are no more cluster centers to pick from\n\n## Results\n\nI won't go through the code (it's all in this [gist](https://gist.github.com/banditkings/6c0345f00c10c2b5acd8f07ebd8e576e)), but we can peek at some fun results!\n\n### Cyberpunk: Edgerunners\n\nUsing the [gist](https://gist.github.com/banditkings/6c0345f00c10c2b5acd8f07ebd8e576e) as `palette.jl`:\n\n```julia\ninclude(\"palette.jl\")\n\nfilepath = \"data/edgerunners mv.gif\"\n\n# Set a seed for reproducibility\nRandom.seed!(42)\n# Get the custom color palette\ntop_colors = make_palette(filepath, 0.4; n_clusters=30)\n# Create a summary plot of the results\nfig = create_summary(filepath, top_colors)\n```\n\nOriginal Image: [Source](https://youtu.be/h4VJGNNSQnw?t=223)\n\n![img](/static/images/palettes/edgerunners_mv.gif)\n\nResult:\n\n_Note: the summary image only shows a single frame from the GIF at the top, but we did indeed use the whole GIF to find the colors_\n\n![img](/static/images/palettes/edgerunners_mv.png)\n\nHere we see that our palette creator was able to get both the pink and green in the original image, and set the background to that cool dark blue color. It uses Lucy's white hair color as the text/grid color and it even picked up the blue of the skin tones.\n\n### Zuko vs Azula from Avatar: The Last Airbender\n\nOriginal: [Source](https://tenor.com/view/zuko-azula-atla-avatar-the-last-airbender-zuko-vs-azula-gif-21600220)\n\n![img](/static/images/palettes/zuko-azula.gif)\n\nResult:\n\n![img](/static/images/palettes/zuko-azula.png)\n\nWatch Zuko and Azula battle it out in lineplot form!\n\n### Genji from the Overwatch 2 Cinematic Trailer\n\nOriginal: [Source](https://youtu.be/GKXS_YA9s7E?t=283)\n\n![img](/static/images/palettes/overwatch2_genji.gif)\n\nResult:\n\n![img](/static/images/palettes/genji.png)\n\nTaking this cool scene from the [the Overwatch 2 Cinematic Trailer](https://youtu.be/GKXS_YA9s7E?t=283) gets us a color palette that captures a lot of the key colors of the character - the color of the sword, the glowing visor, and Genji's uniform all made its way into the palette.\n","srcMarkdownNoYaml":"\n\nHave you ever watched a movie and thought to yourself: \"I bet that scene would make for a great plotting theme.\" Yeah, me too!\n\nRecently I've been drawing inspiration from scenes from anime such as _Cyberpunk: Edgerunners_ ([on Netflix](https://www.netflix.com/title/81054853)), where rich greens, bright pinks, and yellows form a coherent color signature. Color palettes can invoke memories of characters or key moments, and I've found that incorporating even a few of those colors in my data visualizations has rekindled the joy of opening up my IDE and doing some EDA.\n\nUnfortunately, creating custom palettes is time intensive and I have more inspiration than I have free time (especially with two young kids!). Existing free online color palette generators such as [Coolors](https://coolors.co/image-picker), [Adobe Color](https://color.adobe.com/create/image), and [Canva](https://www.canva.com/colors/color-palette-generator/) reveal some limitations:\n\n- Many solutions are _manual_ - users need to manually select colors from an image, which relies on the users' design sense to pick meaningful color combinations\n- Many Automated solutions are _incoherent_ for data visualization - they might select colors that are so similar that they're indistinguishable from each other\n- Existing solutions only take a static image that may fail to capture key colors from the entire scene\n\nHere's an example of what I mean:\n\nI have a GIF captured from a [Cyberpunk: Edgerunners music video](https://youtu.be/h4VJGNNSQnw?t=223) that I want to use to make a color palette for data viz. There's two characters in the scene, Lucy and David:\n\n![img](/static/images/palettes/edgerunners_mv.gif)\n\nBecause existing solutions only let you take a static image, we're forced with taking a single frame from the animation and plug it into a few of them:\n\n![img](/static/images/palettes/existing_solutions.png)\n\n- Canva provides the best palette but only allowed for 4 colors, and notice that purple color doesn't appear in the original image\n- Adobe Color completely missed the pink color and went right to blues and greens\n- Coolors picked a bunch of blue colors, and the last three colors are really hard to tell which is which!\n\n## Solution: Combine clustering with a few extra steps\n\nGiven these gripes with existing palette generators, I decided to make a little function in Julia to extract coherent color palettes from animated GIFs. Clustering (K-means) can summarize the key colors in the GIF and we can use a few simple rules to make a data viz color palette from those key colors.\n\n[Julia's `Images.jl` library](https://juliaimages.org/stable/) is great for working with images (to include animated GIFs), and Julia's type system and native arrays make it trivial to do math on both static and animated images.\n\n## Methods\n\nK-means clustering is a tried and true method for extracting color palettes from images. The basic idea with K-means is that it will iteratively find $K$ cluster centers from the image, where each cluster center is a color that's _close_ to a bunch of colors in the image.\n\n### Rule 1: Ensuring that we use an actual color from the image\n\nThe downside of K-means is that **there's no guarantee that this color actually appears in the original image**!\n\nWe can overcome this with a simple decision rule that substitutes each cluster center with the _nearest_ closest color that exists in the original image. Since each pixel is just an array of numbers, we can calculate _closeness_ using a simple measure like Euclidean distance.\n\n### Rule 2: Use colors that are different from each other\n\nI also want to ensure there's a _minimum distance_ or threshold value between every color in our color palette so that viewers can tell them apart.\n\nTo make this happen we can use a greedy algorithm, something like the below:\n\n- Given an initial list of $K$ colors from the K-means cluster centers:\n  1. Initialize our selected palette with two colors:\n     1. Start with the most common color in the image - this'll be the background color in our data viz\n     2. Find the color with the highest distance from the most common color - this'll be the text/axis/gridline color since it pops out the most from the background\n  2. Rule out any colors from the list of remaining cluster centers that don't meet the minimum distance threshold to any of the selected colors\n  3. From the remaining cluster centers, add the color that has the highest _mean_ distance to the colors in the selected palette\n  4. Repeat steps 2 and 3 until there are no more cluster centers to pick from\n\n## Results\n\nI won't go through the code (it's all in this [gist](https://gist.github.com/banditkings/6c0345f00c10c2b5acd8f07ebd8e576e)), but we can peek at some fun results!\n\n### Cyberpunk: Edgerunners\n\nUsing the [gist](https://gist.github.com/banditkings/6c0345f00c10c2b5acd8f07ebd8e576e) as `palette.jl`:\n\n```julia\ninclude(\"palette.jl\")\n\nfilepath = \"data/edgerunners mv.gif\"\n\n# Set a seed for reproducibility\nRandom.seed!(42)\n# Get the custom color palette\ntop_colors = make_palette(filepath, 0.4; n_clusters=30)\n# Create a summary plot of the results\nfig = create_summary(filepath, top_colors)\n```\n\nOriginal Image: [Source](https://youtu.be/h4VJGNNSQnw?t=223)\n\n![img](/static/images/palettes/edgerunners_mv.gif)\n\nResult:\n\n_Note: the summary image only shows a single frame from the GIF at the top, but we did indeed use the whole GIF to find the colors_\n\n![img](/static/images/palettes/edgerunners_mv.png)\n\nHere we see that our palette creator was able to get both the pink and green in the original image, and set the background to that cool dark blue color. It uses Lucy's white hair color as the text/grid color and it even picked up the blue of the skin tones.\n\n### Zuko vs Azula from Avatar: The Last Airbender\n\nOriginal: [Source](https://tenor.com/view/zuko-azula-atla-avatar-the-last-airbender-zuko-vs-azula-gif-21600220)\n\n![img](/static/images/palettes/zuko-azula.gif)\n\nResult:\n\n![img](/static/images/palettes/zuko-azula.png)\n\nWatch Zuko and Azula battle it out in lineplot form!\n\n### Genji from the Overwatch 2 Cinematic Trailer\n\nOriginal: [Source](https://youtu.be/GKXS_YA9s7E?t=283)\n\n![img](/static/images/palettes/overwatch2_genji.gif)\n\nResult:\n\n![img](/static/images/palettes/genji.png)\n\nTaking this cool scene from the [the Overwatch 2 Cinematic Trailer](https://youtu.be/GKXS_YA9s7E?t=283) gets us a color palette that captures a lot of the key colors of the character - the color of the sword, the glowing visor, and Genji's uniform all made its way into the palette.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles.css"],"output-file":"2022-12-22-color-palette-from-gif-in-julia.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.52","theme":{"light":"cosmo"},"title-block-banner":true,"title":"Creating Color Palettes from Animated GIFs with Julia","date":"2022-12-22","categories":["julia","data visualization"],"summary":"How to automatically generate custom color palettes for data visualization from animated GIFs with Julia","images":["/static/images/palettes/existing_solutions.png","/static/images/palettes/edgerunners mv.gif","/static/images/palettes/edgerunners mv.png","/static/images/palettes/overwatch2 genji.gif","/static/images/palettes/genji.png","/static/images/palettes/zuko-azula.gif","/static/images/palettes/zuko-azula.png"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}